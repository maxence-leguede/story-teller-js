var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{h(r.next(e))}catch(e){s(e)}}function c(e){try{h(r.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}h((r=r.apply(e,t||[])).next())})};class Scene{constructor(e,t){this.id=e,this.order=t}loadConfiguration(e){this.transitionIn=e.transitionIn?e.transitionIn:null,this.transitionOut=e.transitionOut?e.transitionOut:null,this.scrollBehavior=e.scrollBehavior?e.scrollBehavior:"smooth"}scrollTo(){const e=this.scrollBehavior;return new Promise((t,n)=>{const r=document.getElementById(this.id);r?setTimeout(function(){r.scrollIntoView({behavior:e}),t()},200):n(`There is no element with id "${this.id}" in the page.`)})}setSceneScrollBehavior(e){this.scrollBehavior=e}changeSceneOrder(e){this.order=e}setTransitionIn(e){this.transitionIn=e}setTransitionOut(e){this.transitionOut=e}transition(e){return __awaiter(this,void 0,void 0,function*(){if(e){if("function"!=typeof e)throw new Error("StoryTeller.js (transition) : Error during transition, provided transitionIn or transitionOut isn't a function.");return e(this.id)}})}}__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{h(r.next(e))}catch(e){s(e)}}function c(e){try{h(r.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,c)}h((r=r.apply(e,t||[])).next())})};class StoryTeller{constructor(){this.inScroll=!1,this.inAnim=!1,this.scenes=[];let e=this.createScrollEventHandler();window.addEventListener("wheel",e,{passive:!1})}load(e){e.forEach(e=>{this.addScene(e.id,e)})}addScene(e,t){if(null==document.getElementById(e))throw new Error(`StoryTeller.js (addScene) : There is no element with id "${e}".`);if(this.getScene(e))throw new Error(`StoryTeller.js (addScene) : A scene with the id "${e}" already exists.`);const n=this.scenes.length+1,r=new Scene(e,n);return t&&r.loadConfiguration(t),this.scenes.push(r),null==this.currentScene&&(this.currentScene=r,this.currentScene.scrollTo()),this}removeScene(e){const t=this.getScene(e);if(null==t)throw new Error(`StoryTeller.js (addScene) : A scene with the id "${e}" doesn't exist.`);return this.scenes.filter(n=>n.id!==e&&n.order>=t.order).forEach(e=>e.changeSceneOrder(e.order-1)),this.scenes=this.scenes.filter(e=>e.id!==t.id),this}getScene(e){const t=this.scenes.filter(t=>t.id===e);return t.length>0?t.pop():null}getSceneByOrder(e){const t=this.scenes.filter(t=>t.order==e);return t.length>0?t.pop():null}changeSceneOrder(e,t){const n=this.getScene(e);if(!n)throw new Error(`StoryTeller.js (changeSceneOrder) : There is no scene with the id "${e}".`);this.scenes.filter(n=>n.id!==e&&n.order>=t).forEach(e=>e.changeSceneOrder(e.order+1)),n.changeSceneOrder(t),this.scenes.sort((e,t)=>e.order-t.order)}renderTransition(e,t){return __awaiter(this,void 0,void 0,function*(){this.inAnim=!0;const t=this.getSceneByOrder(e);yield this.currentScene.transition(this.currentScene.transitionOut),this.currentScene=t,yield this.currentScene.scrollTo(),yield this.currentScene.transition(this.currentScene.transitionIn),this.inAnim=!1})}createScrollEventHandler(){return e=>{if(e.preventDefault(),!this.inScroll&&!this.inAnim){const t=e.deltaY>0;this.inScroll=!0,setTimeout(()=>{this.inScroll=!1},500),t?this.scenes.length>=this.currentScene.order+1&&this.renderTransition(this.currentScene.order+1,!0):this.currentScene.order-1>0&&this.renderTransition(this.currentScene.order-1,!1)}}}}